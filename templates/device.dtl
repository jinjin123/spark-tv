<!doctype html>
<html>
  <head>
    <base href="http://zkf-tsoc.sparkpos.cn:9080/">
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>SparkPAD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        html, body, .full-screen {
            margin:0; 
            padding:0; 
            height: 100%;
            width: 100%;
            height: 100vh;
            width: 100vw;
            border: none;
        }    
        .relative{
            position: relative;
        }
        .absolute{
            position: absolute;
            left:0;
            top:0;            
        }
        html, body {
            background-color: red;
        }  
        #devinfo {
            text-align: center;         
        }
        .hidden {
            display:none;
        }
        .default{
            background-image: url(assets/bg.png);
            background-repeat: no-repeat;
            background-position: center center;  
            background-color: red;
        }
        .transparent{
            background-color:transparent;
            background-image:none;
        }
        #qrcode {
            display:block;
            margin:auto auto;
            height:800px;
            width:500px;        
        }
        body{
            -webkit-transform-origin: 50% 50%;
        }
        #pid{
            margin:auto auto;
            font-size: 1em;
        }        
    </style>
  </head>

  <body>
    <a id="host" class="hidden", href="http://zkf-tsoc.sparkpos.cn:9080"></a>
    <div id="devinfo" class="hidden">
        <h1>
            Device ID:<span id="id"></span>&nbsp;&nbsp;IP:<span id="ip"></span>&nbsp;&nbsp;<span id="time"></span>&nbsp;&nbsp;WShell:<span id="wshell_status"></span>
        </h1>
        <h1>PID<input id="pid" type="text"></h1>
        <a id="qrcode" class="hidden"></a>        
    </div>       
    <div class='full-screen transparent relative' id="stage">    
        <div class='default full-screen absolute' id='deft'></div>
        <video class='site full-screen transparent absolute' id='video'></video>
        <img class='site full-screen transparent absolute' id='image'></img>
        <iframe class="site full-screen transparent absolute" id='html5' scrolling="no" sandbox:"allow-forms allow-same-origin allow-scripts"></iframe>
        <div class='full-screen transparent absolute' id='overlay'></div>
    </div>



    <script type="text/javascript" src="js/scap/cordova/2.7.0/cordova.webos.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/signage.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/storage.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/configuration.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/deviceInfo.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/inputSource.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/power.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/sound.js"></script>
    <script type="text/javascript" src="js/scap/cordova-cd/1.2/video.js"></script>

    <script type="text/javascript" src="js/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="js/Math.uuid.js"></script>
    <script type="text/javascript" src="js/wshell.js"></script>
    <script type="text/javascript" src="js/qrcodejs/qrcode.js"></script>    
    <script type="text/javascript" src="js/playlists.js"></script>
    <script type="text/javascript" src="js/download.js"></script>
    <script type="text/javascript">
        $(function () {
            try {
                document.onkeydown = onkeydown;
                window.wshell = new Wshell();
                window.repo = new Repository();              
                window.wshell.setHandler('command', function(from,  data, reply_func){
                    window.command(data, reply_func);
                });
                window.config = new Setup('localConfig');
                window.signage = new SparkPOS();
                window.config.setBaseURL("http://115.29.210.136/zkfecp");                 
                window.signage.start(config.playlistURL());
                function onconnect(id) {
                    $("#id").text(id);
                    window.config.setDID(id);                                  
                    window.signage.start(config.playlistURL());
                    window.signage.pulling();
                    if(!window.qrlib) {
                        var url = window.config.get().baseUrl + "/app/bind_store?kernel_version=LG&version=1&orientation=4&size=55&did=" + id;
                        $('#qrcode').html('');
                        $('#qrcode').attr('href', url);
                        window.qrlib = new QRCode(document.getElementById("qrcode"), {
                                    width : 500,
                                    height : 500
                                });
                        window.qrlib.makeCode(url); 
                    }
                }
                function netinfo(ninfo){
                    if(ninfo.isInternetConnectionAvailable){
                        if(ninfo.wired.ipAddress){
                            return 'wired ' + ninfo.wired.ipAddress;
                        } else if(ninfo.wifi.ipAddress){
                            return 'wifi ' + ninfo.wifi.ipAddress;
                        } else if(ninfo.wlan.ipAddress){
                            return 'wlan ' + ninfo.wlan.ipAddress;
                        } else if(ninfo.wifiDirect.ipAddress){
                            return 'wifiDirect ' + ninfo.wifiDirect.ipAddress;
                        } else {
                            return 'unknown IP address';
                        }
                    } else {
                        return 'no internet connection';
                    }                    
                }
                (new DeviceInfo()).getPlatformInfo(function (pinfo) {
                        onconnect(pinfo.serialNumber);
                        (new DeviceInfo()).getNetworkInfo(function (ninfo) {
                            window.wshell.connect(pinfo.serialNumber, ninfo, $('#host').attr('href'));
                            $('#ip').text(netinfo(ninfo));
                        }, function(err) {
                            console.log("getNetworkInfo error: " + JSON.stringify(err));
                            $('#ip').text("getNetworkInfo error: " + JSON.stringify(err));
                        });
                    }, function (err) {
                        console.log("getPlatformInfo error: " + JSON.stringify(err));
                        $('#ip').text("getPlatformInfo error: " + JSON.stringify(err));
                    });
            } catch (e) {
                console.log(e);
                $('#ip').text(e.message);
                window.wshell.connect('exception.' + Math.uuid(16), {error:e.message}, $('#host').attr('href'));
            }
        });
    </script>
  </body>
</html> 
